<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <script type="text/javascript" src="/eel.js"></script>
        <script type="text/javascript" src="bootstrap.min.js"></script>
        <link rel="stylesheet" type="text/css" href="bootstrap.min.css" />
        <link
            rel="icon"
            type="image/png"
            href="img/360_F_535915275_bzBLtYUmIIofc9LMA2vlip2ETfiYCjX.png"
        />
        <title>新入生歓迎会イベントサーバー</title>
        <style>
            .sssm {
                margin: 0;
                height: 20px;
            }
            .zumi {
                background-color: coral;
            }
            .prepara {
                background-color: tan;
            }
            .orange {
                background-color: orange;
            }
            .ip {
                background-color: aquamarine;
                border-radius: 0.2vh;
                padding: 2vh;
                font-size: 4vh;
                width: auto;
                text-align: center;
                margin: 1vh;
            }
            .log {
                margin: 0;
            }
        </style>
    </head>
    <body id="mainbord">
        <div class="container-fluid">
            <div class="row">
                <div class="col-6 vh-100">
                    <div
                        class="row bg-light"
                        style="
                            height: 45vh;
                            margin: 3vh;
                            border-radius: 5vh;
                            text-align: center;
                        "
                    >
                        <div class="row">
                            <div style="float: left">
                                <button
                                    class="btn-success btn"
                                    type="button"
                                    id="sousin"
                                >
                                    送信データ
                                </button>
                                <input
                                    type="text"
                                    placeholder="pc-index"
                                    value=""
                                    id="pc_text"
                                />
                                <input
                                    type="text"
                                    id="sousin_text"
                                    placeholder="data"
                                    value=""
                                /><br />
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <button class="btn btn-dark" id="index_set">
                                    index付与
                                </button>
                                <button class="btn btn-info" id="game_start">
                                    ゲーム開始
                                </button>
                                <button class="btn btn-light" id="game_finish">
                                    ゲーム終了
                                </button>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <button
                                    class="btn btn-danger"
                                    id="index_set_finish"
                                >
                                    index付与終了
                                </button>
                            </div>
                            <div class="col"></div>
                        </div>
                    </div>
                    <div class="row" style="height: 50vh; position: relative">
                        <div class="col-8">
                            <div class="row">
                                <button
                                    class="btn col bg-info disabled"
                                    id="turn_dice"
                                    style="margin: 1em"
                                >
                                    さいころを振る
                                </button>
                            </div>
                            <div class="row">
                                <button
                                    class="btn col bg-info disabled"
                                    id="turn_move"
                                    style="margin: 1em"
                                >
                                    船移動
                                </button>
                            </div>
                            <div class="row">
                                <button
                                    class="btn col bg-info disabled"
                                    id="turn_game"
                                    style="margin: 1em"
                                >
                                    ゲーム開始
                                </button>
                            </div>
                            <div class="row" style="height: 10vh"></div>
                            <div class="row">
                                <button
                                    class="btn col bg-danger"
                                    id="turn_unlock"
                                >
                                    ロック解除
                                </button>
                            </div>
                        </div>
                        <div class="col-4"></div>
                    </div>
                </div>
                <div class="col-6" style="text-align: center">
                    <h1>LOG</h1>
                    <div
                        class="row bg-light"
                        style="
                            height: 50vh;
                            border-width: 5px;
                            border-radius: 3vh;
                            width: 100%;
                            overflow: scroll;
                            text-align: left;
                            padding: 3vh;
                        "
                        id="textb"
                    ></div>
                    <div class="row" style="height: 40vh">
                        <div class="row" style="height: 2em">
                            <div class="col">動作中</div>
                            <div class="col">動作終了</div>
                        </div>
                        <div class="row" style="height: 35vh">
                            <div
                                class="col bg-light"
                                style="overflow: scroll"
                                id="moving"
                            ></div>
                            <div
                                class="col bg-light"
                                style="overflow: scroll"
                                id="moved"
                            ></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row bg-light">
                <div class="col"></div>
            </div>
        </div>
        <!-- Button trigger modal -->
        <div class="row">
            <div class="col-8">
                <button
                    type="button"
                    class="btn btn-primary"
                    data-bs-toggle="modal"
                    data-bs-target="#exampleModal"
                    style="z-index: 100"
                >
                    setting ＆ other
                </button>
            </div>
        </div>
        <!-- Modal -->
        <div
            class="modal fade"
            id="exampleModal"
            tabindex="-1"
            aria-labelledby="exampleModalLabel"
            aria-hidden="true"
        >
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel">
                            Main Menu
                        </h1>
                        <button
                            type="button"
                            class="btn-close"
                            data-bs-dismiss="modal"
                            aria-label="Close"
                        ></button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col">
                                <button
                                    class="btn-dark btn"
                                    type="button"
                                    id="ic_start"
                                    data-bs-dismiss="modal"
                                >
                                    サーバ開始
                                </button>
                            </div>
                            <div class="col">
                                <button
                                    class="btn-light btn"
                                    type="button"
                                    id="ic_stop"
                                    data-bs-dismiss="modal"
                                >
                                    サーバー停止
                                </button>
                            </div>
                            <div class="col">
                                <div style="float: left">
                                    <button
                                        class="btn-success btn"
                                        type="button"
                                        id="ic_inport"
                                    >
                                        データ読み込み
                                    </button>
                                    <input
                                        type="text"
                                        id="ic_text"
                                        value=""
                                    /><br />
                                </div>
                            </div>
                        </div>
                        <div style="display: flex; justify-content: center">
                            <h5>使いたいipを押してください</h5>
                        </div>
                        <div class="row" id="ip_setting"></div>
                        <div class="row">
                            <div class="col justify-content-center">
                                <button class="btn orange" id="manu_id_btn">
                                    サーバーポート
                                </button>
                                <input type="text" value="" id="st_id_manu" />
                            </div>
                        </div>
                        <div class="row" style="margin-top: 3vh">
                            <div class="col-3">
                                <button class="btn btn-success" id="newwin">
                                    中間モニタ&状態確認用window追加
                                </button>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col justify-content-center">
                                <button class="btn orange" id="calc_data">
                                    calc_data
                                </button>
                                <input
                                    type="text"
                                    value=""
                                    id="calc_data_data"
                                />
                            </div>
                            <div class="col">
                                <button class="btn orange" id="conect_rank">
                                    rankingシステム接続
                                </button>
                            </div>
                        </div>
                        <div class="row"><div class="col"></div></div>
                        <div class="row" style="height: 40vh"></div>
                        <div class="row">
                            <div class="col-8"></div>
                            <div class="col-4">
                                <img
                                    src="img/Innovation-AI-LAB.png"
                                    style="max-width: 100%; max-height: 30vh"
                                />
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button
                            type="button"
                            class="btn btn-secondary"
                            data-bs-dismiss="modal"
                        >
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div class="container">
            <!-- メッセージダイアログ -->
            <div
                class="modal fade"
                id="mes_Modal"
                tabindex="-1"
                aria-labelledby="mes_ModalLabel"
                aria-hidden="true"
            >
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="mes_ModalLabel">
                                temp
                            </h5>
                            <button
                                type="button"
                                class="btn-close"
                                data-bs-dismiss="modal"
                                aria-label="Close"
                            ></button>
                        </div>
                        <div class="modal-body" id="mes_Modal_val">temp</div>
                        <div class="modal-footer">
                            <button
                                type="button"
                                class="btn btn-secondary"
                                data-bs-dismiss="modal"
                            >
                                close
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            eel.expose(logprint);
            function logprint(text) {
                output = document.createElement("div");
                output.innerHTML = text;
                document.getElementById("textb").appendChild(output);
                scroll_bottom();
            }
            function scroll_bottom() {
                document.getElementById("textb").scrollTop =
                    document.getElementById("textb").scrollHeight;
            }
            const setting_Modal = new bootstrap.Modal(
                document.getElementById("exampleModal")
            );
            document.getElementById("newwin").addEventListener("click", () => {
                eel.centor_window();
                eel.centor_window2();
            });
            document
                .getElementById("turn_dice")
                .addEventListener("click", () => {
                    eel.dice_turn_start();
                    all_dis_turn();
                });
            document
                .getElementById("turn_move")
                .addEventListener("click", () => {
                    eel.move_ship_turn_start();
                    all_dis_turn();
                });
            document
                .getElementById("turn_game")
                .addEventListener("click", () => {
                    eel.game_turn_start();
                    all_dis_turn();
                });
            document
                .getElementById("index_set_finish")
                .addEventListener("click", () => {
                    eel.finish_set_index();
                });
            document
                .getElementById("conect_rank")
                .addEventListener("click", () => {
                    eel.start2();
                });
            document
                .getElementById("turn_unlock")
                .addEventListener("click", () => {
                    document
                        .getElementById("turn_dice")
                        .classList.remove("disabled");
                    document
                        .getElementById("turn_game")
                        .classList.remove("disabled");
                    document
                        .getElementById("turn_move")
                        .classList.remove("disabled");
                });
            // document
            //     .getElementById("turn_start")
            //     .addEventListener("click", () => {
            //         eel.turn_start();
            //     });
            // let main_statu = false;
            // let setting_modar = true;
            // let taiki = "カードをタッチ";
            // document.getElementById("newwin").addEventListener("click", () => {
            //     eel.new_window();
            // });
            document
                .getElementById("mainbord")
                .addEventListener("keydown", () => {
                    // if (event.code == "ShiftLeft" && main_statu) {
                    //     eel.st_exit(1);
                    //     taiki = "退出モード";
                    //     document.getElementById("ic_statu").innerHTML =
                    //         "退出モード";
                    // }
                    if (event.shiftKey && event.code == "KeyS") {
                        setting_Modal.toggle();
                    }
                    if (event.shiftKey && event.code == "Digit1") {
                        ic_ss();
                        setting_Modal.hide();
                    }
                    if (event.shiftKey && event.code == "Digit2") {
                        eel.server_stop();
                        setting_Modal.hide();
                    }
                    if (event.shiftKey && event.code == "Digit3") {
                        eel.new_window();
                        setting_Modal.hide();
                    }
                });
            function all_dis_turn() {
                document.getElementById("turn_dice").classList.add("disabled");
                document.getElementById("turn_game").classList.add("disabled");
                document.getElementById("turn_move").classList.add("disabled");
            }
            async function set_up() {
                let hoge = await eel.get_ip()();
                document.getElementById("ip_setting").innerHTML = "";
                let i = 0;
                for (hogehoge of hoge) {
                    (function (i1, hoge2) {
                        output = document.createElement("div");
                        output.innerHTML = hoge2;
                        output.setAttribute("id", "ip_" + String(i));
                        output.classList.add("ip");
                        output.classList.add("col");
                        document
                            .getElementById("ip_setting")
                            .appendChild(output);
                        document
                            .getElementById("ip_" + String(i))
                            .addEventListener("click", function () {
                                eel.set_ip_num(i1);
                            });
                    })(i, hogehoge);
                    i = i + 1;
                }
            }
            // document
            //     .getElementById("mainbord")
            //     .addEventListener("keyup", () => {
            //         if (event.code == "ShiftLeft" && main_statu) {
            //             eel.st_exit(0);
            //             taiki = "カードをタッチ";
            //             document.getElementById("ic_statu").innerHTML =
            //                 "カードをタッチ";
            //         }
            //     });
            // const mes_Modal = new bootstrap.Modal(
            //     document.getElementById("mes_Modal")
            // );
            // function scroll_bottom() {
            //     document.getElementById("kitahito").scrollTop =
            //         document.getElementById("kitahito").scrollHeight;
            // }
            // function scroll_bottom2() {
            //     document.getElementById("kitenaihito").scrollTop =
            //         document.getElementById("kitenaihito").scrollHeight;
            // }
            document
                .getElementById("game_start")
                .addEventListener("click", () => {
                    eel.game_start();
                    document
                        .getElementById("turn_dice")
                        .classList.remove("disabled");
                });
            document
                .getElementById("game_finish")
                .addEventListener("click", () => {
                    eel.game_finish();
                    all_dis_turn();
                });
            document
                .getElementById("ic_start")
                .addEventListener("click", () => {
                    ic_ss();
                });
            function ic_ss() {
                eel.server_start();
                console.log("OK");
            }
            document.getElementById("ic_stop").addEventListener("click", () => {
                eel.server_stop();
                console.log("OK2");
            });
            document.getElementById("sousin").addEventListener("click", () => {
                eel.append_senddata(
                    document.getElementById("pc_text").value,
                    document.getElementById("sousin_text").value
                );
            });
            document
                .getElementById("index_set")
                .addEventListener("click", () => {
                    eel.pc_setting();
                });
            eel.expose(logprint_moving);
            function logprint_moving(text) {
                output = document.createElement("div");
                output.innerHTML = text;
                output.id = text;
                document.getElementById("moving").appendChild(output);
                scroll_bottom_moving();
            }
            function scroll_bottom_moving() {
                document.getElementById("moving").scrollTop =
                    document.getElementById("moving").scrollHeight;
            }
            eel.expose(moving_remove);
            function moving_remove(text, statu = 0) {
                document.getElementById(text).remove();
                if (document.getElementById("moving").children.length == 0) {
                    if (statu == 0) {
                        document
                            .getElementById("turn_move")
                            .classList.remove("disabled");
                    } else if (statu == 1) {
                        document
                            .getElementById("turn_game")
                            .classList.remove("disabled");
                    } else if (statu == 2) {
                        document
                            .getElementById("turn_dice")
                            .classList.remove("disabled");
                    }
                }
            }
            eel.expose(logprint_moving_clear);
            function logprint_moving_clear() {
                document.getElementById("moving").innerHTML = "";
            }
            eel.expose(logprint_moved);
            function logprint_moved(text) {
                output = document.createElement("div");
                output.innerHTML = text;
                document.getElementById("moved").appendChild(output);
                scroll_bottom_moved();
            }
            eel.expose(logprint_moved_clear);
            function logprint_moved_clear() {
                document.getElementById("moved").innerHTML = "";
            }
            function scroll_bottom_moved() {
                document.getElementById("moved").scrollTop =
                    document.getElementById("moved").scrollHeight;
            }
            // document
            //     .getElementById("ic_inport")
            //     .addEventListener("click", () => {
            //         eel.inport(document.getElementById("ic_text").value);
            //     });
            // const sleep = (waitTime) =>
            //     new Promise((resolve) => setTimeout(resolve, waitTime));
            // document
            //     .getElementById("add_st_id")
            //     .addEventListener("click", () => {
            //         eel.add_data(
            //             document.getElementById("add_st_id_val").value
            //         );
            //     });
            // document
            //     .getElementById("delete_st_id")
            //     .addEventListener("click", () => {
            //         eel.delete_data(
            //             document.getElementById("delete_st_id_val").value
            //         );
            //     });
            document
                .getElementById("manu_id_btn")
                .addEventListener("click", () => {
                    eel.set_ship_move_time(
                        document.getElementById("st_id_manu").value
                    );
                });
            document
                .getElementById("calc_data")
                .addEventListener("click", () => {
                    eel.solve_problem(
                        "::FF" +
                            document.getElementById("calc_data_data").value +
                            "FF::",
                        "localhost"
                    );
                });
            // eel.expose(mes_show);
            // function mes_show(lab, mes) {
            //     document.getElementById("mes_Modal_val").innerHTML = mes;
            //     document.getElementById("mes_ModalLabel").innerHTML = lab;
            //     mes_Modal.show();
            // }

            // eel.expose(setup);
            // function setup(list) {
            //     console.log(list);
            // }
            // eel.expose(ic_output);
            // function ic_output(a, b, c) {
            //     console.log(a);
            //     console.log(b);
            //     ic_output2(a, b, c);
            // }

            // eel.expose(prepare);
            // function prepare() {
            //     main_statu = false;
            //     document.getElementById("ic_statu").innerHTML = "準備中";
            //     document.getElementById("ic_back").classList.add("prepare");
            // }

            // eel.expose(hanei);
            // function hanei(a, b) {
            //     main_statu = true;
            //     console.log(a);
            //     console.log(b);
            //     document.getElementById("kitahito").innerHTML = "";
            //     for (let i = 0; i < a.length; i++) {
            //         output = document.createElement("div");
            //         output.innerHTML = a[i];
            //         output.classList.add("sssm");
            //         document.getElementById("kitahito").appendChild(output);
            //         scroll_bottom();
            //     }
            //     document.getElementById("kitenaihito").innerHTML = "";
            //     for (let i = 0; i < b.length; i++) {
            //         output = document.createElement("div");
            //         output.innerHTML = b[i];
            //         output.classList.add("sssm");
            //         document.getElementById("kitenaihito").appendChild(output);
            //         scroll_bottom2();
            //     }
            // }

            // let ok = 1;
            // async function ic_output2(i_st_id, i_st_name, ad = -1) {
            //     if (ok == 0) {
            //         return;
            //     }
            //     ok = 0;
            //     console.log(ad);
            //     console.log(i_st_id);
            //     console.log(i_st_name);
            //     document.getElementById("st_id").innerHTML = i_st_id;
            //     document.getElementById("st_name").innerHTML = i_st_name;
            //     document
            //         .getElementById("ic_back")
            //         .classList.remove(
            //             ...document.getElementById("ic_back").classList
            //         );
            //     if (ad == 1) {
            //         document.getElementById("ic_statu").innerHTML = "認証成功";
            //         document
            //             .getElementById("ic_back")
            //             .classList.add("bg-success");
            //     } else if (ad == 2) {
            //         document.getElementById("ic_statu").innerHTML = "重複認証";
            //         document.getElementById("ic_back").classList.add("zumi");
            //     } else if (ad == 3) {
            //         prepare();
            //         return;
            //     } else {
            //         document.getElementById("ic_statu").innerHTML = "認証不可";
            //         document
            //             .getElementById("ic_back")
            //             .classList.add("bg-danger");
            //     }
            //     await sleep(1500);
            //     document.getElementById("st_id").innerHTML = "   ";
            //     document.getElementById("st_name").innerHTML = "   ";
            //     document.getElementById("ic_statu").innerHTML = taiki;
            //     document
            //         .getElementById("ic_back")
            //         .classList.remove(
            //             ...document.getElementById("ic_back").classList
            //         );
            //     document.getElementById("ic_back").classList.add("bg-primary");
            //     ok = 1;
            //     if (i_st_id == "処理停止") {
            //         prepare();
            //     }
            // }
            set_up();
        </script>
    </body>
</html>
